<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connexion - KMERSCHOOL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        * {
            font-family: 'Outfit', sans-serif;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .animated-gradient {
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }

        @keyframes gradient {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .input-group:focus-within label {
            color: #7c3aed;
        }

        .input-group:focus-within input {
            border-color: #7c3aed;
            box-shadow: 0 0 0 4px rgba(124, 58, 237, 0.1);
        }
    </style>
</head>

<body class="animated-gradient min-h-screen flex items-center justify-center relative overflow-hidden">

    <!-- Absolute Top-Left Logo -->
    <a href="index.html" class="absolute top-6 left-6 z-50 hover:opacity-80 transition-opacity">
        <img src="assets/logo/LOGO.png" alt="KMERSCHOOL" class="h-24 w-auto object-contain drop-shadow-lg">
    </a>

    <!-- Main Container -->
    <div class="relative z-10 w-full max-w-md px-4">

        <div class="glass-panel p-10 rounded-3xl shadow-2xl transform hover:scale-[1.01] transition-all duration-300">

            <div class="text-center mb-10">
                <h2 class="text-4xl font-extrabold text-gray-900 tracking-tight">Bienvenue sur KMERSCHOOL</h2>
                <p class="mt-3 text-gray-600">Connectez-vous pour continuer votre apprentissage</p>
            </div>

            <!-- Message Container -->
            <div id="messageContainer" class="hidden mb-6 p-4 rounded-xl text-sm font-medium animate-pulse"></div>

            <form id="loginForm" class="space-y-6">
                <!-- Email -->
                <div class="input-group">
                    <label for="email" class="block text-sm font-bold text-gray-700 mb-2 ml-1">Email
                        professionnel</label>
                    <input id="email" name="email" type="email" required
                        class="w-full px-5 py-4 bg-gray-50 border-2 border-gray-100 rounded-xl text-gray-900 font-medium placeholder-gray-400 focus:outline-none focus:bg-white transition-all duration-200"
                        placeholder="nom@exemple.com">
                </div>

                <!-- Password -->
                <div class="input-group">
                    <div class="flex justify-between items-center mb-2 ml-1">
                        <label for="password" class="block text-sm font-bold text-gray-700">Mot de passe</label>
                        <a href="#"
                            class="text-sm font-semibold text-purple-600 hover:text-purple-800 transition-colors">Oublié
                            ?</a>
                    </div>
                    <input id="password" name="password" type="password" required
                        class="w-full px-5 py-4 bg-gray-50 border-2 border-gray-100 rounded-xl text-gray-900 font-medium placeholder-gray-400 focus:outline-none focus:bg-white transition-all duration-200"
                        placeholder="••••••••">
                </div>

                <!-- Remember Me -->
                <div class="flex items-center ml-1">
                    <input id="remember" type="checkbox"
                        class="w-5 h-5 text-purple-600 border-2 border-gray-300 rounded focus:ring-purple-500 cursor-pointer">
                    <label for="remember" class="ml-3 text-sm font-medium text-gray-600 cursor-pointer select-none">Se
                        souvenir de moi</label>
                </div>

                <!-- Submit Button -->
                <button type="submit" id="loginBtn"
                    class="w-full py-4 bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-bold rounded-xl shadow-lg hover:shadow-purple-500/30 hover:-translate-y-1 transition-all duration-200 text-lg tracking-wide">
                    Se connecter
                </button>
            </form>

            <div class="mt-8 text-center">
                <p class="text-gray-600 font-medium">
                    Pas encore de compte ?
                    <a href="register.html"
                        class="text-purple-600 hover:text-purple-800 font-bold ml-1 hover:underline decoration-2 underline-offset-4 transition-all">
                        Créer un compte
                    </a>
                </p>
            </div>
        </div>

        <p class="text-center text-white/80 mt-8 text-sm font-medium">
            &copy; 2024 KMERSCHOOL. Tous droits réservés.
        </p>
    </div>

    <!-- Script Logic (Preserved but integrated) -->
    <script type="module">
        const SUPABASE_URL = 'https://zbbulpomopfwkqipbehk.supabase.co'
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpiYnVscG9tb3Bmd2txaXBiZWhrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM0MDM3NDksImV4cCI6MjA3ODk3OTc0OX0.Heak4t8B6vtUIX0SxlOW7W75cn1KD5UYe0lkoO1kW7A'
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

        async function checkExistingSession() {
            const { data: { user } } = await supabase.auth.getUser()
            if (user) {
                await redirectToDashboard(user.id)
            }
        }

        async function redirectToDashboard(userId) {
            try {
                const { data: profile } = await supabase
                    .from('profiles')
                    .select('type_parcours')
                    .eq('id', userId)
                    .single()

                if (!profile) {
                    await supabase.auth.signOut()
                    return // Silent fail/refresh
                }

                switch (profile.type_parcours) {
                    case 'eleve': window.location.href = 'Dashboard-eleves/dashboard-eleve.html'; break;
                    case 'dev-web': window.location.href = 'Dashboard-Dev/dashboard-dev.html'; break;
                    case 'designer': window.location.href = 'Dashboard-designer/dashboard-designer.html'; break;
                    default: window.location.href = 'index.html';
                }
            } catch (error) {
                console.error('Error redirecting:', error)
            }
        }

        function showMessage(message, type = 'info') {
            const container = document.getElementById('messageContainer')
            // Reset classes
            container.className = `mb-6 p-4 rounded-xl text-sm font-bold text-center animate-pulse ${type === 'error' ? 'bg-red-50 text-red-600 border border-red-100' :
                type === 'success' ? 'bg-green-50 text-green-600 border border-green-100' : 'bg-blue-50 text-blue-600'
                }`
            container.textContent = message
            container.classList.remove('hidden')

            if (type === 'success') {
                setTimeout(() => container.classList.add('hidden'), 3000)
            }
        }

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault()
            const email = document.getElementById('email').value.trim()
            const password = document.getElementById('password').value
            const btn = document.getElementById('loginBtn')

            if (!email || !password) {
                showMessage('Veuillez remplir tous les champs', 'error')
                return
            }

            btn.disabled = true
            btn.innerHTML = '<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Connexion...'

            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email,
                    password
                })

                if (error) throw error

                showMessage('Connexion réussie !', 'success')
                setTimeout(() => {
                    redirectToDashboard(data.user.id)
                }, 800)

            } catch (error) {
                let msg = 'Erreur de connexion'
                if (error.message.includes('Invalid login credentials')) msg = 'Identifiants incorrects'
                showMessage(msg, 'error')
                btn.disabled = false
                btn.textContent = 'Se connecter'
            }
        })

        // Init
        checkExistingSession()
    </script>
</body>

</html>