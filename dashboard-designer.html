<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Design Studio - LearnHub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', sans-serif; }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-4px); box-shadow: 0 20px 40px rgba(139,92,246,0.15); }
        .gradient-design { background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%); }
    </style>
</head>
<body class="bg-gray-50">

    <!-- NAVBAR -->
    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-600 rounded-xl flex items-center justify-center">
                        <span class="text-white font-bold text-xl">üé®</span>
                    </div>
                    <div>
                        <div class="text-lg font-bold text-gray-900">Design Studio</div>
                        <div class="text-xs text-gray-500">UI/UX Designer</div>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="hidden md:flex items-center space-x-6">
                        <a href="#" class="text-gray-600 hover:text-purple-600 font-medium">Apprendre</a>
                        <a href="#" class="text-gray-600 hover:text-purple-600 font-medium">Portfolio</a>
                        <a href="#" class="text-gray-600 hover:text-purple-600 font-medium">Inspiration</a>
                    </div>
                    
                    <div class="relative">
                        <button id="userMenuBtn" class="flex items-center space-x-2 px-3 py-2 rounded-lg hover:bg-gray-100">
                            <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center text-white font-semibold text-sm">
                                <span id="userInitial">D</span>
                            </div>
                            <span class="hidden md:block font-medium" id="userName">Designer</span>
                        </button>
                        
                        <div id="userDropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-xl border">
                            <a href="index.html" class="block px-4 py-2 hover:bg-gray-50">üè† Accueil</a>
                            <a href="#" class="block px-4 py-2 hover:bg-gray-50">üìÅ Mon Portfolio</a>
                            <a href="#" class="block px-4 py-2 hover:bg-gray-50">‚öôÔ∏è Param√®tres</a>
                            <hr>
                            <button id="logoutBtn" class="w-full text-left px-4 py-2 text-red-600 hover:bg-red-50">üö™ D√©connexion</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- HERO SECTION -->
    <div class="gradient-design py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center text-white mb-8">
                <h1 class="text-5xl font-bold mb-3">Salut <span id="userNameHeader">Designer</span>! ‚ú®</h1>
                <p class="text-purple-100 text-xl">Cr√©ons des exp√©riences qui inspirent</p>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="bg-white/20 backdrop-blur-sm rounded-xl p-4 text-white text-center">
                    <div class="text-3xl font-bold" id="statProjects">0</div>
                    <div class="text-sm text-purple-100">Designs cr√©√©s</div>
                </div>
                <div class="bg-white/20 backdrop-blur-sm rounded-xl p-4 text-white text-center">
                    <div class="text-3xl font-bold" id="statHours">0h</div>
                    <div class="text-sm text-purple-100">Temps de design</div>
                </div>
                <div class="bg-white/20 backdrop-blur-sm rounded-xl p-4 text-white text-center">
                    <div class="text-3xl font-bold" id="statSkills">0</div>
                    <div class="text-sm text-purple-100">Comp√©tences</div>
                </div>
                <div class="bg-white/20 backdrop-blur-sm rounded-xl p-4 text-white text-center">
                    <div class="text-3xl font-bold" id="statXP">0</div>
                    <div class="text-sm text-purple-100">Points XP</div>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

        <!-- PARCOURS D'APPRENTISSAGE -->
        <div class="mb-12">
            <h2 class="text-3xl font-bold text-gray-900 mb-6">Ton Parcours Design</h2>
            
            <div id="parcoursGrid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Parcours charg√©s ici -->
                <div class="col-span-full text-center py-12">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500 mx-auto mb-4"></div>
                    <p class="text-gray-500">Chargement de ton parcours...</p>
                </div>
            </div>
        </div>

        <!-- OUTILS DE DESIGN -->
        <div class="mb-12">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Outils √† Ma√Ætriser</h2>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                <div class="card-hover bg-white rounded-xl p-6 shadow-sm border border-gray-100 text-center">
                    <div class="text-4xl mb-3">üé≠</div>
                    <h3 class="font-bold text-gray-900">Figma</h3>
                    <div class="mt-3 w-full h-2 bg-gray-200 rounded-full">
                        <div class="h-full bg-purple-500 rounded-full" style="width: 0%"></div>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">0% compl√©t√©</p>
                </div>

                <div class="card-hover bg-white rounded-xl p-6 shadow-sm border border-gray-100 text-center">
                    <div class="text-4xl mb-3">üñåÔ∏è</div>
                    <h3 class="font-bold text-gray-900">Adobe XD</h3>
                    <div class="mt-3 w-full h-2 bg-gray-200 rounded-full">
                        <div class="h-full bg-pink-500 rounded-full" style="width: 0%"></div>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">0% compl√©t√©</p>
                </div>

                <div class="card-hover bg-white rounded-xl p-6 shadow-sm border border-gray-100 text-center">
                    <div class="text-4xl mb-3">üé®</div>
                    <h3 class="font-bold text-gray-900">Design Systems</h3>
                    <div class="mt-3 w-full h-2 bg-gray-200 rounded-full">
                        <div class="h-full bg-indigo-500 rounded-full" style="width: 0%"></div>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">0% compl√©t√©</p>
                </div>

                <div class="card-hover bg-white rounded-xl p-6 shadow-sm border border-gray-100 text-center">
                    <div class="text-4xl mb-3">‚ú®</div>
                    <h3 class="font-bold text-gray-900">Prototyping</h3>
                    <div class="mt-3 w-full h-2 bg-gray-200 rounded-full">
                        <div class="h-full bg-purple-500 rounded-full" style="width: 0%"></div>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">0% compl√©t√©</p>
                </div>
            </div>
        </div>

        <!-- MON PORTFOLIO -->
        <div class="mb-12">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-900">Mon Portfolio</h2>
                <button class="px-6 py-2 bg-gradient-to-r from-purple-600 to-pink-600 text-white font-semibold rounded-lg hover:shadow-lg transition">
                    + Nouveau Projet
                </button>
            </div>
            
            <div id="portfolioGrid" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="card-hover bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden cursor-pointer">
                    <div class="h-48 bg-gradient-to-br from-purple-400 to-pink-400 flex items-center justify-center">
                        <span class="text-white text-6xl">üé®</span>
                    </div>
                    <div class="p-4">
                        <h3 class="font-bold text-gray-900 mb-1">Commence ton premier design</h3>
                        <p class="text-sm text-gray-600">Cr√©e un projet pour construire ton portfolio</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- INSPIRATION DU JOUR -->
        <div class="mb-12">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Inspiration du Jour</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="card-hover bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                    <div class="text-4xl mb-4">üí°</div>
                    <h3 class="font-bold text-gray-900 mb-2">Design Trends 2025</h3>
                    <p class="text-gray-600 text-sm mb-4">D√©couvre les tendances qui fa√ßonnent le design moderne</p>
                    <a href="#" class="text-purple-600 font-semibold hover:text-purple-700">Lire l'article ‚Üí</a>
                </div>

                <div class="card-hover bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                    <div class="text-4xl mb-4">üéØ</div>
                    <h3 class="font-bold text-gray-900 mb-2">UX Best Practices</h3>
                    <p class="text-gray-600 text-sm mb-4">Les meilleures pratiques pour cr√©er des exp√©riences m√©morables</p>
                    <a href="#" class="text-purple-600 font-semibold hover:text-purple-700">En savoir plus ‚Üí</a>
                </div>

                <div class="card-hover bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                    <div class="text-4xl mb-4">üñºÔ∏è</div>
                    <h3 class="font-bold text-gray-900 mb-2">Color Theory</h3>
                    <p class="text-gray-600 text-sm mb-4">Ma√Ætrise l'art des couleurs dans tes designs</p>
                    <a href="#" class="text-purple-600 font-semibold hover:text-purple-700">Apprendre ‚Üí</a>
                </div>
            </div>
        </div>

    </div>

    <script>
        const SUPABASE_URL = 'https://zbbulpomopfwkqipbehk.supabase.co'
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpiYnVscG9tb3Bmd2txaXBiZWhrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM0MDM3NDksImV4cCI6MjA3ODk3OTc0OX0.Heak4t8B6vtUIX0SxlOW7W75cn1KD5UYe0lkoO1kW7A'
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

        let currentUser = null
        let userProfile = null

        async function checkAuth() {
            const { data: { user } } = await supabase.auth.getUser()
            
            if (!user) {
                window.location.href = 'login.html'
                return
            }

            currentUser = user

            const { data: profile } = await supabase
                .from('profiles')
                .select('*')
                .eq('id', user.id)
                .single()

            if (!profile || profile.type_parcours !== 'designer') {
                alert('Acc√®s refus√©. Cette page est r√©serv√©e aux designers.')
                window.location.href = 'index.html'
                return
            }

            userProfile = profile
            
            const prenom = profile.nom.split(' ')[0]
            document.getElementById('userName').textContent = prenom
            document.getElementById('userNameHeader').textContent = prenom
            document.getElementById('userInitial').textContent = prenom.charAt(0).toUpperCase()

            loadStats()
            loadParcours()
        }

        async function loadStats() {
            try {
                const { count: projectCount } = await supabase
                    .from('soumissions_projets')
                    .select('*', { count: 'exact', head: true })
                    .eq('user_id', currentUser.id)

                document.getElementById('statProjects').textContent = projectCount || 0

                const { data: progressions } = await supabase
                    .from('progressions_cours')
                    .select('temps_passe')
                    .eq('user_id', currentUser.id)

                const totalSeconds = progressions?.reduce((acc, p) => acc + (p.temps_passe || 0), 0) || 0
                document.getElementById('statHours').textContent = Math.floor(totalSeconds / 3600) + 'h'

                const { count: skillCount } = await supabase
                    .from('progressions_cours')
                    .select('*', { count: 'exact', head: true })
                    .eq('user_id', currentUser.id)
                    .eq('est_termine', true)

                document.getElementById('statSkills').textContent = skillCount || 0
                document.getElementById('statXP').textContent = userProfile.points_total || 0

            } catch (error) {
                console.error('Erreur chargement stats:', error)
            }
        }

        async function loadParcours() {
            try {
                const { data: matieres } = await supabase
                    .from('matieres')
                    .select('*')
                    .eq('type_parcours', 'designer')
                    .order('ordre', { ascending: true })

                const grid = document.getElementById('parcoursGrid')
                
                if (!matieres || matieres.length === 0) {
                    grid.innerHTML = '<p class="col-span-full text-gray-500 text-center py-12">Aucun parcours disponible</p>'
                    return
                }

                grid.innerHTML = matieres.map(matiere => `
                    <div class="card-hover bg-white rounded-xl p-8 shadow-sm border-2 border-gray-100">
                        <div class="flex items-start justify-between mb-4">
                            <div class="w-16 h-16 bg-gradient-to-br from-purple-100 to-pink-100 rounded-2xl flex items-center justify-center text-3xl">
                                ${getDesignIcon(matiere.nom)}
                            </div>
                            <span class="px-3 py-1 bg-purple-100 text-purple-700 text-xs font-semibold rounded-full">
                                0/5 modules
                            </span>
                        </div>
                        
                        <h3 class="text-xl font-bold text-gray-900 mb-2">${matiere.nom}</h3>
                        <p class="text-gray-600 mb-6">${matiere.description || 'Ma√Ætrise cet outil essentiel'}</p>
                        
                        <div class="mb-4">
                            <div class="flex justify-between text-sm mb-2">
                                <span class="text-gray-600">Progression</span>
                                <span class="font-semibold text-purple-600">0%</span>
                            </div>
                            <div class="w-full h-3 bg-gray-200 rounded-full overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-purple-500 to-pink-500" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <button onclick="goToMatiere('${matiere.slug}')" class="w-full px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold rounded-xl hover:shadow-lg transition">
                            Commencer le cours
                        </button>
                    </div>
                `).join('')

            } catch (error) {
                console.error('Erreur chargement parcours:', error)
            }
        }

        function getDesignIcon(nom) {
            const icons = {
                'Figma': 'üé≠',
                'Principes UX': 'üéØ',
                'Design Systems': 'üé®',
                'Typography': 'üî§'
            }
            return icons[nom] || '‚ú®'
        }

        function goToMatiere(slug) {
            window.location.href = `matiere.html?slug=${slug}`
        }

        document.getElementById('userMenuBtn').addEventListener('click', (e) => {
            e.stopPropagation()
            document.getElementById('userDropdown').classList.toggle('hidden')
        })

        document.addEventListener('click', () => {
            document.getElementById('userDropdown').classList.add('hidden')
        })

        document.getElementById('logoutBtn').addEventListener('click', async () => {
            await supabase.auth.signOut()
            window.location.href = 'login.html'
        })

        checkAuth()
    </script>
</body>
</html>